{"version":3,"sources":["lib/cache-route/es/index.js","pages/a.js","pages/b.js","App.js","index.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","_extends","assign","target","i","arguments","length","source","prototype","hasOwnProperty","call","apply","this","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","__proto__","_setPrototypeOf","p","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","_assertThisInitialized","self","ReferenceError","_possibleConstructorReturn","window","history","scrollRestoration","deepCopy","JSON","parse","stringify","CacheRoute","_Component","_getPrototypeOf2","_this","_len","args","Array","_key","concat","React","createRef","visible","$instance","$pageElement","document","scrollingElement","documentElement","scrollTop","lastVisible","setTimeout","scrollTo","pageRef","current","matchCount","componentDidShow","lastProps","lastState","getBodyScrollTop","componentWillHide","props","state","_this$props","Component","component","restProps","createElement","Route","children","_ref","match","storeScrollInfoIfLeavePage","restoreScrollInfoIfShowPage","style","display","getPageVisible","$CacheRouteInjectPageElement","ref","subClass","superClass","create","constructor","_inherits","A","console","log","componentDidMount","componentWillUnmount","handleSubmit","values","render","textAlign","onFinish","Item","label","name","rules","required","message","htmlType","marginRight","type","onClick","push","B","App","path","exact","to","PageA","PageB","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.251953f4.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport { Route } from 'react-router-dom';\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nif (window.history && window.history.scrollRestoration && window.history.scrollRestoration === \"auto\") {\n  window.history.scrollRestoration = \"manual\";\n}\n\nvar deepCopy = function deepCopy(obj) {\n  return JSON.parse(JSON.stringify(obj));\n};\n\nvar CacheRoute = /*#__PURE__*/function (_Component) {\n  _inherits(CacheRoute, _Component);\n\n  function CacheRoute() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, CacheRoute);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(CacheRoute)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"visible\", false);\n\n    _defineProperty(_assertThisInitialized(_this), \"matchCount\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"scrollTop\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"$pageElement\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"pageRef\", React.createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"lastProps\", {});\n\n    _defineProperty(_assertThisInitialized(_this), \"lastState\", {});\n\n    _defineProperty(_assertThisInitialized(_this), \"shouldComponentUpdate\", function () {\n      return false;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getPageVisible\", function () {\n      return _this.visible;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"$CacheRouteInjectPageElement\", function ($instance) {\n      _this.$pageElement = $instance;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getBodyScrollTop\", function () {\n      var el = document.scrollingElement || document.documentElement;\n      return el.scrollTop;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"restoreScrollInfoIfShowPage\", function (lastVisible) {\n      if (_this.visible && !lastVisible) {\n        setTimeout(function () {\n          var el = document.scrollingElement || document.documentElement;\n          el.scrollTo(0, _this.scrollTop);\n          var $pageElement = _this.$pageElement || _this.pageRef.current;\n          /**\n           * componentDidShow在componentDidUpdate后触发\n           * 当触发componentDidShow的时候，滚动条位置已经恢复\n           * 第一次进入页面，不会执行componentDidShould\n           */\n\n          if (_this.matchCount > 1 && $pageElement && $pageElement.componentDidShow) {\n            $pageElement.componentDidShow(_this.lastProps, _this.lastState);\n          }\n        }, 0);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"storeScrollInfoIfLeavePage\", function (lastVisible) {\n      if (!_this.visible && lastVisible) {\n        _this.scrollTop = _this.getBodyScrollTop();\n        var $pageElement = _this.$pageElement || _this.pageRef.current;\n\n        if ($pageElement && $pageElement.componentWillHide) {\n          _this.lastProps = deepCopy($pageElement.props);\n          _this.lastState = deepCopy($pageElement.state);\n          $pageElement.componentWillHide();\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"render\", function () {\n      var _this$props = _this.props,\n          Component = _this$props.component,\n          restProps = _objectWithoutProperties(_this$props, [\"component\"]);\n\n      return React.createElement(Route, _extends({}, restProps, {\n        children: function children(_ref) {\n          var match = _ref.match,\n              restProps = _objectWithoutProperties(_ref, [\"match\"]);\n\n          var lastVisible = _this.visible;\n\n          if (match) {\n            _this.visible = true;\n            _this.matchCount++;\n          } else {\n            _this.visible = false;\n          }\n\n          _this.storeScrollInfoIfLeavePage(lastVisible);\n\n          _this.restoreScrollInfoIfShowPage(lastVisible);\n\n          return _this.matchCount > 0 ? React.createElement(\"div\", {\n            style: {\n              display: _this.visible ? \"block\" : \"none\"\n            }\n          }, React.createElement(Component, _extends({}, restProps, {\n            getPageVisible: _this.getPageVisible,\n            $CacheRouteInjectPageElement: _this.$CacheRouteInjectPageElement,\n            ref: _this.pageRef\n          }))) : null;\n        }\n      }));\n    });\n\n    return _this;\n  }\n\n  return CacheRoute;\n}(Component);\n\nexport default CacheRoute;\n","import React from \"react\";\nimport { Form, Input, Button } from \"antd\";\n\nclass A extends React.Component {\n  componentDidShow = (lastProps, lastState) => {\n    console.log(\"component did show\");\n    console.log(\"lastProps:\", lastProps, \"lastState:\", lastState);\n  };\n\n  componentDidMount = () => {\n    console.log(\"component did mount\");\n  };\n\n  componentWillHide = () => {\n    console.log(\"component will hide\");\n  };\n\n  componentWillUnmount = () => {\n    // componentWillUnmount将失效\n    // 业务逻辑需要移动到componentWillHide\n  };\n\n  handleSubmit = (values) => {\n    console.log(values);\n  };\n\n  render = () => {\n    return (\n      <div style={{ textAlign: \"center\" }}>\n        <div style={{ display: \"inline-block\", textAlign: 'left' }}>\n          <h1>Page A</h1>\n\n          <Form onFinish={this.handleSubmit}>\n            <Form.Item\n              label=\"您的姓名\"\n              name=\"name\"\n              rules={[\n                {\n                  required: true,\n                  message: \"请输入您的姓名\"\n                }\n              ]}\n            >\n              <Input />\n            </Form.Item>\n\n            <Button htmlType=\"submit\" style={{ marginRight: 10 }} type=\"primary\">\n              提交\n            </Button>\n\n            <Button onClick={() => this.props.history.push(\"/b\")}>去页面B</Button>\n          </Form>\n        </div>\n      </div>\n    );\n  };\n}\n\nexport default A;\n","import React from \"react\";\nimport { Input, Form, Button } from \"antd\";\n\nclass B extends React.Component {\n  render = () => {\n    return (\n      <div style={{ textAlign: \"center\" }}>\n        <div style={{ display: \"inline-block\", textAlign: 'left' }}>\n          <h1>Page B</h1>\n          <Form onFinish={this.handleSubmit}>\n            <Form.Item\n              label=\"编程语言\"\n              name=\"lang\"\n              rules={[\n                {\n                  required: true,\n                  message: \"请输入您的主要编程语言\"\n                }\n              ]}\n            >\n              <Input />\n            </Form.Item>\n\n            <Button htmlType=\"submit\" style={{ marginRight: 10 }} type=\"primary\">\n              提交\n            </Button>\n            <Button onClick={() => this.props.history.push(\"/a\")}>去页面A</Button>\n          </Form>\n        </div>\n      </div>\n    );\n  };\n}\n\nexport default B;\n","import React from \"react\";\nimport { HashRouter, Route, Redirect } from \"react-router-dom\";\nimport CacheRoute from \"./lib/cache-route\";\nimport PageA from \"./pages/a\";\nimport PageB from \"./pages/b\";\n\nfunction App() {\n  return (\n    <HashRouter>\n      <Route path=\"/\" exact render={() => <Redirect to=\"/a\" />} />\n      <CacheRoute path=\"/a\" component={PageA} />\n      <Route path=\"/b\" component={PageB} />\n    </HashRouter>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}